// Generated by CoffeeScript 1.6.3
(function() {
  var Crop, expenses, money, net, potato, profit, timer_step, update_profit, update_text, update_timing, wage_driver, wage_farmer;

  money = 50;

  profit = 60;

  expenses = 20;

  net = 40;

  wage_farmer = 6;

  wage_driver = 8;

  Crop = (function() {
    function Crop(val_seed, val_crop) {
      this.val_seed = val_seed;
      this.val_crop = val_crop;
      this.num_farmers = 0;
      this.num_acres = 0;
      this.num_harvested = 0;
      this.num_drivers = 0;
      this.num_drivers_max = 0;
      this.num_shipping = 0;
      this.time_harvest = 0;
      this.time_harvest_max = 0;
      this.time_shipping = 0;
      this.time_shipping_max = 0;
    }

    return Crop;

  })();

  update_timing = function() {
    potato.time_harvest_max = potato.num_acres / (potato.num_farmers * 0.2);
    return potato.time_harvest = (potato.num_acres - potato.num_harvested) / (potato.num_farmers * 0.2);
  };

  update_profit = function() {
    var time;
    time = Math.max(potato.time_harvest_max, potato.time_shipping_max);
    profit = potato.val_crop * potato.num_acres * 60 / time;
    expenses = potato.num_farmers * wage_farmer + potato.num_drivers_max * wage_driver + potato.val_seed * potato.num_acres * 60 / time;
    return net = profit - expenses;
  };

  update_text = function() {
    $('#money').text("$" + (money.toFixed(2)));
    $('#profit').text("$" + (profit.toFixed(2)) + "/min");
    $('#expenses').text("$" + (expenses.toFixed(2)) + "/min");
    $('#net').text("$" + (net.toFixed(2)) + "/min");
    $('.potato #num_farmers').text(potato.num_farmers);
    $('.potato #num_acres').text(potato.num_acres);
    $('.potato #num_harvested').text(Math.floor(potato.num_harvested));
    $('.potato #time_harvest').text("" + (Math.ceil(potato.time_harvest)) + " (" + (Math.ceil(potato.time_harvest_max)) + ") sec");
    $('.potato #num_drivers').text("" + potato.num_drivers + "/" + potato.num_drivers_max);
    return $('.potato #time_shipping').text("" + (Math.ceil(potato.time_shipping)) + " (" + (Math.ceil(potato.time_shipping_max)) + ") sec");
  };

  timer_step = function() {
    potato.num_harvested = Math.min(potato.num_acres, potato.num_harvested + potato.num_farmers * 0.2);
    if (potato.time_harvest > 0) {
      potato.time_harvest--;
    }
    if (potato.num_harvested >= potato.num_acres && potato.num_drivers > 0) {
      potato.num_shipping = potato.num_harvested;
      potato.num_harvested = 0;
      money -= potato.val_seed * potato.num_acres;
      potato.num_drivers--;
      potato.time_shipping = potato.time_shipping_max;
      potato.time_harvest = potato.time_harvest_max;
    }
    if (potato.time_shipping > 0) {
      potato.time_shipping--;
      if (potato.time_shipping <= 0) {
        money += potato.val_crop * potato.num_shipping;
        potato.num_shipping = 0;
        potato.num_drivers++;
      }
    }
    money -= (potato.num_farmers * wage_farmer + potato.num_drivers_max * wage_driver) / 60;
    return update_text();
  };

  potato = new Crop(0.50, 5);

  potato.num_farmers = 1;

  potato.num_acres = 10;

  potato.num_drivers_max = 1;

  potato.num_drivers = 1;

  potato.time_harvest = 50;

  potato.time_harvest_max = 50;

  potato.time_shipping_max = 20;

  update_text();

  $(document).ready(function() {
    return setInterval(timer_step, 1000);
  });

  $('#hire_farmer').button().click(function() {
    potato.num_farmers++;
    update_timing();
    update_profit();
    return update_text();
  });

  $('#fire_farmer').button().click(function() {
    if (potato.num_farmers > 1) {
      potato.num_farmers--;
    }
    update_timing();
    update_profit();
    return update_text();
  });

  $('#hire_driver').button().click(function() {
    potato.num_drivers++;
    potato.num_drivers_max++;
    update_timing();
    update_profit();
    return update_text();
  });

  $('#fire_driver').button().click(function() {
    if (potato.num_drivers > 1) {
      potato.num_drivers--;
      potato.num_drivers_max--;
    }
    update_timing();
    update_profit();
    return update_text();
  });

}).call(this);
